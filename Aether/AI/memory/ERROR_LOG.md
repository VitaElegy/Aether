# Aether Error Log & Troubleshooting Guide

This document summarizes known errors encountered during the development of the Aether platform, their root causes, and resolutions. It serves as a knowledge base for future debugging and feature implementation.

| Error / Issue                             | Description                                                                                     | Root Cause                                                                                                           | Resolution                                                                                    | Detailed Report                                            |
| :---------------------------------------- | :---------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------- | :--------------------------------------------------------- |
| **Failed to Load Version Data**           | Version Detail view showed error toast; no content displayed.                                   | Backend `ContentVersionSnapshot` missing `body` field.                                                               | Updated model and `ArticleRepository::get_version` to fetch/populate `body`.                  | [Link](error/failed_to_load_version_history_and_diff.md)   |
| **Blank Review Changes Interface**        | Diff view displayed white empty card.                                                           | Mismatch between Backend Diff String and Frontend JSON Array expectation.                                            | Refactored `get_diff` to return structured JSON `[{tag, value}]`.                             | [Link](error/failed_to_load_version_history_and_diff.md)   |
| **Invalid Version ID (500)**              | Diff view toggle caused 500 API Error.                                                          | Frontend sent SemVer `0.0.X` instead of Integer ID `X`.                                                              | Fixed frontend to use simple integer string IDs.                                              | [Link](error/failed_to_load_version_history_and_diff.md)   |
| **Failed to Create Knowledge Base**       | "Create" button did nothing; 404/500 Errors.                                                    | Missing Database Table `knowledge_bases` and API Route not registered.                                               | Created Schema, Implemented Repository, Registered Route.                                     | [Link](error/failed_to_create_knowledge_base.md)           |
| **Failed to Associate Article to KB**     | Created article validly but didn't appear in KB.                                                | `knowledge_base_id` was ignored/dropped during SAVE.                                                                 | Updated `ArticleRepository::save` to persist `knowledge_base_id`.                             | [Link](error/failed_to_associate_article_to_kb.md)         |
| **Failed to List KB Articles**            | KB Detail page showed empty list.                                                               | `list` endpoint didn't support filtering by `knowledge_base_id`.                                                     | Updated `ArticleRepository::list` to accept and filter by KB ID.                              | [Link](error/failed_to_list_kb_articles.md)                |
| **Failed to Post Comment (500)**          | Comment submission failed.                                                                      | Schema Mismatch: DB `target_id` was UUID, Frontend sent generic string ID.                                           | Migrated DB column to `TEXT` to support polymorphic IDs.                                      | [Link](error/failed_to_post_comment.md)                    |
| **Failed to Publish Article (No-Op)**     | 400 Bad Request or No verification.                                                             | Missing Validation for Duplicate Titles and Changes.                                                                 | Implemented Title Uniqueness Check and No-Op detection logic.                                 | [Link](error/failed_to_publish_article.md)                 |
| **Auto-Save Refresh/Redirect Loop**       | Editor refreshed and "auto-published" (switched article).                                       | Frontend `saveDraft` auto-redirected to existing ID on 409 Conflict.                                                 | Removed redirect logic; added explicit "Draft/Published" status UI.                           | [Link](error/auto_save_redirect_loop.md)                   |
| **Infinite Loading on ReadView**          | "ESTABLISHING UPLINK" displayed forever on some articles.                                       | `ReadView` crashed on string-only `body` format (Legacy vs New JSON).                                                | Updated `loadData` to safely parse string or object `body`.                                   | [Link](error/infinite_loading_readview.md)                 |
| **Ghost Articles (List vs Get)**          | Article visible in List but returns 404/Crash on click.                                         | `ArticleRepository::list` returned raw Nodes even if `article_details` missing.                                      | Filtered `list` and `find_by_id` to exclude/404 incomplete articles.                          | [Link](error/ghost_articles_list_mismatch.md)              |
| **Auto-Save Unpublishes Article**         | Editing Published article reverts it to Draft.                                                  | Frontend `saveDraft` hardcoded `status: 'Draft'`.                                                                    | Updated `saveDraft` to respect current `form.status` (e.g. keep Published).                   | [Link](error/auto_save_unpublishes.md)                     |
| **Phantom Refresh on Public Page**        | Hovering on public article triggered refresh/error logs.                                        | `EditorView` auto-save logic leaked into `ReadView` (debounce not cancelled).                                        | Cancelled `debouncedAutoSave` on `onBeforeUnmount`.                                           | [Link](error/phantom_refresh_public_page.md)               |
| **Editor Navigation Lock**                | "Back" button stuck/dead on direct link entry.                                                  | `router.back()` fails if no browser history exists.                                                                  | Implemented `goBack` with fallback to Home (`/`).                                             | [Link](error/editor_navigation_lock.md)                    |
| **Editor Stuck After Auto-Save**          | UI frozen on Editor after clicking Back (post-edit).                                            | Unhandled exception in `onBeforeUnmount` (cleanup) aborted navigation.                                               | Wrapped cleanup logic in `try-catch` block to ensure navigation proceeds.                     | [Link](error/editor_stuck_after_autosave.md)               |
| **Failed to Search (500)**                | Search API crashed with "no column found".                                                      | SeaORM `select_only()` optimization prevented full model hydration.                                                  | Removed `select_only()` to fetch full rows for safe hydration.                                | [Link](error/failed_to_search_500.md)                      |
| **Compilation Issues (Refactor)**         | Backend failed to compile after large refactor.                                                 | Trait bounds, missing fields in `ActiveModel`, unused imports.                                                       | Fixed `User` entity relations, Axum handlers, and imports.                                    | [Link](error/refactor_v1_compilation_issues.md)            |
| **Frontend Cache Scoping (Ghost)**        | Editor showed "Ghost Articles" when switching folders.                                          | `localStorage` restored draft without matching `knowledge_base_id` context.                                          | Added strict check: Cache must match URL `kb_id` and `parent_id` to restore.                  | [Link](error/frontend_cache_scoping_ghost.md)              |
| **Startup Panic & Build Failure**         | Backend crashed on start; Frontend failed to build.                                             | Duplicate Route `/api/users/search`; TSConfig `moduleResolution` mismatch.                                           | Removed duplicate route; Updated TSConfig to `bundler`; Fixed Vue Type Errors.                | [Link](error/startup_panic_and_build_failures.md)          |
| **Ghost Auto-Publish**                    | Articles auto-published while staying on editor.                                                | Backend defaulted missing `status` to "Published" in Create/Update handlers.                                         | Changed default to "Draft" (Create) and "Preserve Existing" (Update).                         | [Link](error/ghost_auto_publish.md)                        |
| **Content Creation Race Condition**       | "Article with this title already exists" on Publish.                                            | Auto-Save and Publish triggered concurrent POST requests; bypassed state lock.                                       | Centralized `create` logic in `useContent`; Enforced `isSaving` lock.                         | [Link](error/content_creation_race_condition.md)           |
| **Cache Restoration Loop**                | "Restored unsaved content" appears erroneously.                                                 | Server Sync updated `form` -> `watch(form)` updated Cache Timestamp > Server.                                        | Added `isSyncing` flag to ignore Server-driven updates in Cache Watcher.                      | N/A                                                        |
| **Live Content Corruption**               | Editing Published article modified live view immediately.                                       | Auto-Save (`PUT`) updated backend live record regardless of Publish action.                                          | Disabled Backend Auto-Save for `Published` status (Local Cache Only).                         | N/A                                                        |
| **Live Content Corruption**               | Auto-save was overwriting published content with draft data without user intent.                | Auto-Save (`PUT`) updated backend live record regardless of Publish action.                                          | Fixed by aborting auto-save if status is 'Published'.                                         | N/A                                                        |
| **Data Leaking in Profile**               | Backend `list` method ignored `author_id` parameter, causing User Profiles to show global feed. | `ArticleRepository::list` ignored `author_id` parameter.                                                             | Fixed by adding query filter to `ArticleRepository::list`.                                    | N/A                                                        |
| **KB List Not Displaying**                | KB list empty in Self Space despite backend success.                                            | Missing `Authorization` header in frontend `knowledgeApi.list()`.                                                    | Added auth header to `api/knowledge.ts` methods.                                              | N/A                                                        |
| **Function Card Syntax Error**            | `::: function-card` rendered as raw text.                                                       | Markdown preprocessor lacked support for `function-card` syntax.                                                     | Added regex replacer for `::: function-card` in `MathMinisiteLayout`.                         | N/A                                                        |
| **Knowledge Graph Empty**                 | Graph showed only root node.                                                                    | `AsciiTreeParser` didn't support Markdown lists (`*`/`-`).                                                           | Implemented `parseMarkdownList` in `AsciiTreeParser.ts`.                                      | N/A                                                        |
| **Graph Too Dark**                        | Knowledge Graph illegible on black overlay.                                                     | Default dark styling clashed with content/usability.                                                                 | Switched to Light Mode (White Overlay + Dark Nodes).                                          | N/A                                                        |
| **Math Rendering inside Semantic Blocks** | `$$...$$` inside semantic blocks rendered as text.                                              | Markdown parser prioritized paragraph token over block math.                                                         | Added `inlineBlockMath` tokenizer to handle display math in inline contexts.                  | [Link](error/math_rendering_failure_in_semantic_blocks.md) |
| **Malformed Vue Template Crash**          | "Unclickable/Frozen Page" on new layout.                                                        | Duplicate `</div>` and `</template>` tags at end of `FocusStage.vue`.                                                | Removed redundant closing tags; fixed HTML structure.                                         | N/A                                                        |
| **Silent Registry Failure**               | Layouts failed to load without error feedback.                                                  | Registry silently fell back to Default or rendered broken component.                                                 | Implemented `RendererErrorLayout` and `onErrorCaptured` hook in `ReadView`.                   | N/A                                                        |
| **Math Rendering Regression**             | Formulas inside semantic blocks rendered as text.                                               | Ad-hoc regex wrapping in Layout caused Parser to treat content as Raw HTML.                                          | Refactored to use `marked` Extensions for Math and Semantic Blocks globally.                  | [Link](error/math_rendering_regression.md)                 |
| **Content Scoping Leak**                  | English Module showed Math articles.                                                            | Backend filter worked but logic was permissive; likely dirty data or edge cases.                                     | Implemented "Client-Side Firewall" in `ArticleAnalysisModule` to strictly filter by category. | N/A                                                        |
| **Navigation Pollution**                  | Vocabulary Module switches overlapped with Global Nav.                                          | Ad-hoc absolute positioning of controls.                                                                             | Refactored to "Dynamic Navigation Registration" using Teleport Portals.                       | N/A                                                        |
| **Nav Pollution (Buttons Gone)**          | Nav buttons disappeared or persisted erroneously on module switch.                              | Race condition between `onDeactivated` (cleanup) and `onActivated` (setup) + aggressive Global Reset.                | Implemented `nextTick` in `onActivated` + removed Global Reset + Strict Content `v-if`.       | N/A                                                        |
| **Module White Screen**                   | `KnowledgeModule` failed to render (white screen) when loaded.                                  | `<LayoutSelectionModal>` placed outside root `div`, creating a multi-root Fragment unsupported by Router/Transition. | Moved modal inside root `div`.                                                                | [Link](error/module_white_screen_fragment.md)              |
| **DataCloneError in Storage**             | Console error `DataCloneError` during navigation persistence.                                   | Attempted to save Vue Proxy objects directly to IndexedDB.                                                           | Applied `toRaw()` to unwrap proxies before saving.                                            | [Link](error/datacloneerror_in_storage.md)                 |
| **Library ID Fetch Error (400)**          | `/api/knowledge-bases/library` returned 400 Bad Request.                                        | Frontend treated reserved UI state ID `'library'` as a valid Backend Resource ID.                                    | Added guard clause to ignore `'library'` ID in API calls.                                     | [Link](error/library_id_fetch_error_400.md)                |
| **Renderer Not Found**                | Application failed to load with "Renderer not found" for various KBs.                           | Mismatch between Database IDs (e.g. `math_v1_std`) and Plugin Registry IDs (`math`).                                 | Added robust Alias Registration in `main.ts` to map legacy/variant IDs to correct plugins.                    | N/A |
| **Dashboards Crash on Load**          | `TypeError: Cannot read properties of undefined` in Dashboards.                                 | `SelfSpaceView` passed `kbId` but Dashboards expected `kb` object prop (Prop Starvation).                            | Updated `SelfSpaceView` to compute and pass `activeKb` object; Added defensive `v-if` checks in Dashboards.   | N/A |
| **Missing Table (vocab_roots)** | Save failed with "no such table: vocab_roots". | Migration file `z_create_vocab_roots.sql` was missing despite Entity existing. | Created `z_fix_vocab_schema.sql` to create table and fix `vocab_details` FK. | N/A |
| **Missing Table (vocab_examples)** | Save failed with 500 Error (likely "no such table: vocab_examples"). | Migration file for `vocab_examples` was missing despite Entity existing. | Created `z_create_vocab_examples.sql` to create table. | N/A |